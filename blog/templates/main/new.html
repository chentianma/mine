{% extends 'base.html' %}

{% block head %}
    {{ super() }}
    <style>
        #marked_page {
            width: 100%;
            height: 600px;
            overflow: auto;
        }

        #input_area {
            width: 100%;
            height: 500px;
        }

        pre code {
            color: #0642ff;
        }
    </style>
    <script src="{{ url_for('static', filename='js/marked.js') }}"></script>
{#    <script src="{{ url_for('static', filename='js/underscore.js') }}"></script>#}
{% endblock %}

{% block content %}
    <div id="editor" class="row well">
        <div class="col-md-6">
            <form>
                <div class="form-group">
                    <input v-model='blog.title' id="textinput" type="text" class="form-control" placeholder="标题">
                </div>
                <div class="form-group">
                    <input v-model='blog.description' type="text" class="form-control" placeholder="描述">
                </div>
                <div class="form-group">
                    <textarea id="input_area" class="form-control" v-model="blog.text" placeholder="正文"></textarea>
                </div>
                <div class="form-group">
                    <select id="cate" class="form-control">
                        <option>Python</option>
                        <option>JavaScript</option>
                        <option>Life</option>
                    </select>
                </div>
                <div class="row">
                    <div class="col-md-10 col-md-offset-1">
                        <button type="button" class="btn btn-primary btn-block" @click="submit_edit">提交</button>
                    </div>
                </div>

            </form>
        </div>
        <div class="col-md-6">
            <div id="marked_page" class="panel panel-default">
                <div class="panel-body" v-html="compiledMarkdown"></div>
            </div>
        </div>
    </div>
{% endblock %}
{% block scripts %}
    <script>
        new Vue({
            el: '#editor',
            data: {
                blog: {
                    'id': null,
                    'url': null,
                    'title': null,
                    'text': '',
                    'time': null,
                    'user': null,
                    'category': null
                },
                markhtml: ''
            },
            computed: {
                compiledMarkdown: function () {
                    this.markhtml = marked(this.blog.text, {sanitize: true});
                    return this.markhtml
                }
            },
            methods: {
                submit_edit: function () {
                    this.blog.category = $("#cate option:selected").text();
                    $.post('/api/blog/edit', this.blog, function (data, status) {
                        var blog_id = data.id;
                        $(location).attr('href', '/blog/' + blog_id);
                    });
                }
            }
        })
    </script>
{% endblock %}