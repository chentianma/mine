{% extends 'base.html' %}

{% block head %}
    {{ super() }}
    <link rel="stylesheet" href="{{ url_for('static', filename='uikit/css/components/htmleditor.css') }}"/>
    <script src="{{ url_for('static', filename='uikit/js/components/htmleditor.js') }}"></script>

{% endblock %}

{% block board %}
    <div class="uk-grid uk-grid-collapse">
        <form id="editor" class="uk-width-1-1 uk-form">
            <div class="uk-form-row">
                <div class="uk-form-controls">
                    <input v-model='blog.title' type="text" class="uk-width-1-1" placeholder="标题">
                </div>
            </div>
            <div class="uk-form-row">
                <div class="uk-form-controls">
                    <input v-model='blog.description' type="text" class="uk-width-1-1" placeholder="描述">
                </div>
            </div>
            <div class="uk-form-row">
                <div class="uk-form-controls">
                    <textarea id="editor_string" cols="" rows="" placeholder=""
                              data-uk-htmleditor="{ mode:'split', markdown:true}"></textarea>
                </div>
            </div>
            <div class="uk-form-row">
                <select id="cate" class="uk-form-controls">
                    <option>Python</option>
                    <option>JavaScript</option>
                    <option>Life</option>
                </select>
            </div>
            <div class="uk-form-row">
                <div class="uk-form-controls">
                    <button type="button" class="uk-button uk-width-1-1 button_shadow uk-border-rounded" @click="submit_edit">提交</button>
                </div>
            </div>
        </form>
    </div>
{% endblock %}

{% block content %}
{% endblock %}

{% block sidebar %}
{% endblock %}

{% block scripts %}
        <script>
            vm = new Vue({
                el: '#editor',
                data: {
                    blog: {
                        'id': null,
                        'url': null,
                        'title': null,
                        'text': '',
                        'time': null,
                        'user': null,
                        'category': null
                    },
                    markhtml: ''
                },
                computed: {
                    compiledMarkdown: function () {
                        this.markhtml = marked(this.blog.text, {sanitize: true});
                        return this.markhtml
                    }
                },
                methods: {
                    submit_edit: function () {
                        this.blog.category = $("#cate option:selected").text();
{#                        this.blog.text = $('.CodeMirror-code').text();#}
                        this.blog.text = $('#editor_string').val();
                        $.post('/api/blog/create', this.blog, function (data, status) {
                            var blog_id = data.id;
                            $(location).attr('href', '/blog/' + blog_id);
                        });
                    }
                }
            })
        </script>
{% endblock %}