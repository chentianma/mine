{% extends 'base.html' %}

{% block head %}
    {{ super() }}
    <style>
        #markedpage {
            width: 100%;
            height: 800px;
            overflow: auto;
        }

        #inputarea {
            width: 100%;
            height: 650px;
        }

        pre code {
            color: #0642ff;
        }
    </style>
    <script src="{{ url_for('static', filename='js/marked.js') }}"></script>
    <script src="{{ url_for('static', filename='js/underscore.js') }}"></script>
{% endblock %}

{% block content %}
    <div id="editor" class="row well">
        <div class="col-md-6">
            <form>
                <div class="form-group">
                    {#                    <label for="textinput"></label>#}
                    <input v-model='blog.title' id="textinput" type="text" class="form-control">
                </div>
                <div class="form-group">
                    <input v-model='blog.description' type="text" class="form-control">
                </div>
                <div class="form-group">
                    <textarea id="inputarea" class="form-control" v-model="blog.text"></textarea>
                </div>
{#                <div class="form-group">#}
{#                    <select class="form-control">#}
{#                        <option  v-text="blog.category"></option>#}
{#                        <option>JavaScript</option>#}
{#                    </select>#}
{#                </div>#}
                <div class="row">
                    <div class="col-md-10 col-md-offset-1">
                        <button type="button" class="btn btn-primary btn-block" @click="submit_edit">提交</button>
                    </div>
                </div>
            </form>
{#            <form action="">#}
{#                <div class="form-group">#}
{#                    <label for="image">File input</label>#}
{#                    <input type="file" id="image">#}
{#                    <p class="help-block">Example block-level help text here.</p>#}
{#                </div>#}
{##}
{#            </form>#}
        </div>
        <div class="col-md-6">
            {#            <div class="embed-responsive embed-responsive-4by3">#}
            {#                <iframe class="embed-responsive-item" src="" v-html="compiledMarkdown"></iframe>#}
            {#            </div>#}
            <div id="markedpage" class="panel panel-default">
                <div class="panel-body" v-html="compiledMarkdown"></div>
            </div>
        </div>
    </div>
{% endblock %}
{% block scripts %}
    <script>
        var editor_vm = new Vue({
            el: '#editor',
            data: {
                blog: {
                    'id': null,
                    'url': null,
                    'title': null,
                    'text': '',
                    'time': null,
                    'user': null,
                    'new_category': null,
                    'category': null,
                    'description': '',
                    'img_url': null
                },
                markhtml: ''
            },
            computed: {
                compiledMarkdown: function () {
                    this.markhtml = marked(this.blog.text, {sanitize: true});
                    return this.markhtml
                }
            },
            methods: {
                submit_edit: function () {
                    $.post('/api/blog/' + this.blog.id + '/edit', this.blog, function (data, status) {
                        var blog_id = data.id;
                        $(location).attr('href', '/blog/' + blog_id);
                    });
                }
            }
        });

        function initPage() {
            var path = window.location.pathname;
            $.get('/api' + path, function (data, status) {
                {#                alert(JSON.stringify(data.blog));#}
                editor_vm.blog = data.blog;
            });
        }
        ;

        initPage();
    </script>
{% endblock %}