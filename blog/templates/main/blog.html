{% extends 'base.html' %}

{% block head %}
    {{ super() }}
    <script src="{{ url_for('static', filename='js/marked.js') }}"></script>
    {#    <script src="{{ url_for('static', filename='js/underscore.js') }}"></script>#}
    <style>
    pre code {
            color: #0642ff;
        }
    </style>
{% endblock %}

{% block content %}
    <div class="row">
        <div class="col-md-8">
            <div id="article">
                {#                <h1 class="text-center lead text-success"><strong v-text="blog.title"></strong></h1>#}
                <div class="row">
                    <div class="col-md-10">
                        <h1 class="text-center lead text-success" v-text="blog.title"></h1>
                    </div>
                    <div class="col-md-2 pull-right" style="padding-top: 15px">
                        {% if current_user.is_authenticated %}
                            <a :href="'/blog/edit/'+blog.id">
                                <button class="btn btn-info btn-sm">
                                    <span class="glyphicon glyphicon-edit"></span>
                                </button>
                            </a>
                        {% endif %}
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-7 col-xs-8">
                        <p class="text-left lead h5">
                            <em>
                                <small v-text="'Published：'+blog.time"></small>
                            </em>
                        </p>
                    </div>
                    <div class="col-md-5 col-xs-4">
                        <h5 class="text-right lead">
                            <em>
                                <small v-text="'Category：'+blog.category"></small>
                            </em>
                        </h5>
                    </div>
                    {#                    {% if current_user.is_authenticated %}#}
                    {#                        <div class="col-md-1 pull-right" style="padding-top: 12px">#}
                    {#                            <a :href="'/blog/edit/'+blog.id">#}
                    {#                                <button class="btn btn-info btn-sm">#}
                    {#                                    <span class="glyphicon glyphicon-edit"></span>#}
                    {#                                </button>#}
                    {#                            </a>#}
                    {#                        </div>#}
                    {#                    {% endif %}#}
                </div>
                <div v-html="compiledMarkdown"></div>
            </div>
        </div>
    </div>
{% endblock %}
{% block scripts %}
    <script>
        var art_vm = new Vue({
            el: '#article',
            data: {
                blog: {},
                markhtml: ''
            },
            computed: {
                compiledMarkdown: function () {
                    this.markhtml = marked(this.blog.text, {sanitize: true});
                    return this.markhtml
                }
            }
        });

        function initPage() {
            var path = window.location.pathname;
            $.get('/api' + path, function (data, status) {
                {#                alert(JSON.stringify(data.blog));#}
                art_vm.blog = data.blog;
            });
        }
        ;

        initPage();

    </script>
{% endblock %}